import{D as h,b as r,S as D,u as x,d as i,Q as y,v as B,I as k,e as E,_ as q,r as u,c,a as d,i as o,w as C,j as f,t as p,k as _,o as g}from"./index-BuEX8aWP.js";import{A as L}from"./AlbumViewer-DZo0RTmv.js";import{D as A}from"./DocLister-j7iOy4f8.js";import"./moment-with-locales-DfJgAdxo.js";const j={data(){return{id:"",title_en:"",title_hu:"",title_rs:"",content_rs:"",content_hu:"",content_en:"",yt_video:"",show_date:!1,srb_flag:!0,hun_flag:!0,en_flag:!1,visible:!1,documents_flag:!1,album_flag:!1,default_img_link:"",gallery_id:"",file_link:null,fb_message:"",fb_public:!1,img:"",headers:[],colDefs:[],documents:[],doc_loaded:!1,notNews:!0,uploading:!1}},components:{AlbumViewer:L,DocLister:A},mounted(){this.id=this.$route.params.id,this.getMD(),this.headers=[{title:this.$t("name"),align:"start",sortable:!1,key:"name",width:"200px"},{title:this.$t("date"),align:"start",key:"date",width:"300px"},{title:this.$t("open_document"),align:"start",key:"open",width:"300px"}],this.headers.push({title:this.$t("edit_document"),align:"start",key:"edit",width:"300px"}),this.colDefs.push({field:"edit",headerName:this.$t("edit_message"),sortable:!0,filter:!0}),window.addEventListener("beforeunload",this.handleBeforeUnload)},onBeforeUnmount(){window.removeEventListener("beforeunload",this.handleBeforeUnload)},methods:{async getMD(){const l=new h(r),t=new D(r);x();let a=await l.listDocuments(i.website_db,i.about_us_db,[y.equal("$id",this.$route.params.id)]);this.title_rs=a.documents[0].title_rs,this.content_rs=a.documents[0].text_rs,this.title_hu=a.documents[0].title_hu,this.content_hu=a.documents[0].text_hu,this.title_en=a.documents[0].title_en,this.content_en=a.documents[0].text_en,this.yt_video=a.documents[0].yt_video,this.visible=a.documents[0].visible,this.notNews=a.documents[0].notNews,this.show_date=a.documents[0].show_date,a.documents[0].default_image==null||a.documents[0].default_image==""?this.img="https://dummyimage.com/720x400":this.img=t.getFileView(i.website_images,a.documents[0].default_image).toString(),this.gallery_id=a.documents[0].gallery,this.documents_flag=a.documents[0].has_documents,this.album_flag=a.documents[0].has_gallery,this.synchronize_documents()},handleBeforeUnload(l){if(this.uploading)return l.preventDefault(),this.$notify({type:"error",text:this.$t("file_still_uploading")}),l.returnValue="",""},async save(){const l=new h(r);await l.listDocuments(i.website_db,i.about_us_db,[y.equal("$id",this.$route.params.id)]),this.album_flag||(this.gallery_id=null),await l.updateDocument(i.website_db,i.about_us_db,this.$route.params.id,{title_rs:this.title_rs,title_hu:this.title_hu,title_en:this.title_en,text_en:this.content_en,text_hu:this.content_hu,text_rs:this.content_rs,isHungarian:this.hun_flag,isSerbian:this.srb_flag,isEnglish:this.en_flag,visible:this.visible,yt_video:this.yt_video,has_documents:this.documents_flag,has_gallery:this.album_flag,gallery:this.gallery_id,default_image:this.default_image,notNews:this.notNews,show_date:this.show_date}),this.$notify(this.$t("saved"))},async share_fb(){let t=await new h(r).getDocument(i.website_db,i.users_settings,"fb_access_token"),a=`https://share.tsada.edu.rs/${this.$route.params.id}`;const w=await B.post(`https://graph.facebook.com/v20.0/${i.pan}/feed`,{message:null,link:a,access_token:t.parameter,published:!0});console.log(w)},async documents_load(){this.save(),this.synchronize_documents()},async gallery_change(){this.gallery_id==null&&(this.gallery_id=await this.new_gallery()),this.save()},async new_stuff(){const t=await new h(r).createDocument(i.website_db,i.text_documents,k.unique(),{texts:this.$route.params.id});this.$router.push("/admin/text-document-editor/"+t.$id)},async new_gallery(){return(await new h(r).createDocument(i.website_db,i.gallery,k.unique(),{visible:!1,title_rs:this.title_rs,title_hu:this.title_hu,title_en:this.title_en})).$id},async synchronize_documents(){const l=new h(r);if(this.documents_flag){this.doc_loaded=!1,this.documents=[];let a=x().language;await(await l.listDocuments(i.website_db,i.text_documents,[y.equal("texts",[this.$route.params.id])])).documents.forEach(async e=>{let n={name:"",contact:"",img:"",id:"",doc_id:"",date:""};n.id=e.$id,a=="en"||a=="hu"?(n.name=e.document_title_hu,n.contact=e.contact):(a=="rs"||a=="sr")&&(n.name=E(e.document_title_rs),n.contact=e.contact),n.id=e.$id,n.doc_id=e.document_id,n.date=e.$createdAt,this.documents.push(n)}),this.doc_loaded=!0}},async delete_content(){await new h(r).deleteDocument(i.website_db,i.about_us_db,this.$route.params.id),this.$notify(this.$t("deleted")),this.$router.push("/home")},async file_upload(){if(!this.file_link){console.warn("no file");return}console.log("file_upload"),this.uploading=!0;const t=await new D(r).createFile(i.website_images,k.unique(),this.file_link);this.default_image=t.$id,this.save(),this.$notify(this.$t("file_uploaded")),this.uploading=!1}}},z={class:"relative mb-4 container px-5 mx-auto bg-white"},Q={class:"flex flex-wrap -m-4"},F={class:"xl:w-1/5 md:w-1/2 p-4 cursor-pointer"},I={class:"bg-slate-100/30 hover:bg-sky-600/30 dark:bg-slate-300/30 p-6 rounded-lg shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07),0_10px_20px_-2px_rgba(0,0,0,0.04)]"},M=["src"],H={key:0},T={key:0},G={key:0},J={key:0},K={key:0};function O(l,t,a,w,e,n){const m=u("v-switch"),v=u("v-btn"),U=u("v-file-input"),b=u("v-text-field"),V=u("ckeditor");u("QuillEditor"),u("router-link"),u("v-data-table");const N=u("DocLister"),S=u("AlbumViewer");return g(),c("div",z,[d("div",null,[o(m,{onChange:n.save,modelValue:e.visible,"onUpdate:modelValue":t[0]||(t[0]=s=>e.visible=s),label:l.$t("visible")},null,8,["onChange","modelValue","label"]),o(m,{onChange:n.save,modelValue:e.notNews,"onUpdate:modelValue":t[1]||(t[1]=s=>e.notNews=s),label:l.$t("not_news")},null,8,["onChange","modelValue","label"]),o(m,{onChange:n.save,modelValue:e.show_date,"onUpdate:modelValue":t[2]||(t[2]=s=>e.show_date=s),label:l.$t("show_date")},null,8,["onChange","modelValue","label"]),o(v,{class:"m-5",onClick:n.save},{default:C(()=>[f(p(l.$t("save")),1)]),_:1},8,["onClick"]),o(v,{class:"m-5",onClick:n.delete_content},{default:C(()=>[f(p(l.$t("delete")),1)]),_:1},8,["onClick"]),o(v,{class:"m-5",onClick:n.share_fb},{default:C(()=>[f(p(l.$t("fb_share")),1)]),_:1},8,["onClick"])]),d("div",null,[o(U,{onChange:n.file_upload,modelValue:e.file_link,"onUpdate:modelValue":t[3]||(t[3]=s=>e.file_link=s),accept:"image/*",label:l.$t("fileupload")},null,8,["onChange","modelValue","label"]),f(" "+p(l.$t("preview"))+" ",1),d("div",Q,[d("div",F,[d("div",I,[d("img",{class:"h-40 rounded w-full object-cover object-center mb-6 transition duration-300 ease-in-out",src:e.img,alt:"content"},null,8,M)])])])]),d("div",null,[o(m,{onChange:n.save,modelValue:e.srb_flag,"onUpdate:modelValue":t[4]||(t[4]=s=>e.srb_flag=s),label:l.$t("srb")},null,8,["onChange","modelValue","label"]),e.srb_flag?(g(),c("div",H,[o(b,{onChange:n.save,modelValue:e.title_rs,"onUpdate:modelValue":t[5]||(t[5]=s=>e.title_rs=s),counter:100,label:l.$t("srb_title"),"hide-details":""},null,8,["onChange","modelValue","label"]),o(V,{modelValue:e.content_rs,"onUpdate:modelValue":t[6]||(t[6]=s=>e.content_rs=s)},null,8,["modelValue"]),_("",!0)])):_("",!0)]),d("div",null,[o(m,{modelValue:e.hun_flag,"onUpdate:modelValue":t[8]||(t[8]=s=>e.hun_flag=s),onChange:n.save,label:l.$t("hu")},null,8,["modelValue","onChange","label"]),e.hun_flag?(g(),c("div",T,[o(b,{modelValue:e.title_hu,"onUpdate:modelValue":t[9]||(t[9]=s=>e.title_hu=s),counter:100,onChange:n.save,label:l.$t("hu_title"),"hide-details":""},null,8,["modelValue","onChange","label"]),o(V,{modelValue:e.content_hu,"onUpdate:modelValue":t[10]||(t[10]=s=>e.content_hu=s)},null,8,["modelValue"]),_("",!0)])):_("",!0)]),d("div",null,[o(m,{modelValue:e.en_flag,"onUpdate:modelValue":t[12]||(t[12]=s=>e.en_flag=s),onChange:n.save,label:l.$t("en")},null,8,["modelValue","onChange","label"]),e.en_flag?(g(),c("div",G,[o(b,{modelValue:e.title_en,"onUpdate:modelValue":t[13]||(t[13]=s=>e.title_en=s),counter:100,onChange:n.save,label:l.$t("en_title"),"hide-details":""},null,8,["modelValue","onChange","label"]),o(V,{modelValue:e.content_en,"onUpdate:modelValue":t[14]||(t[14]=s=>e.content_en=s)},null,8,["modelValue"]),_("",!0)])):_("",!0)]),o(b,{modelValue:e.yt_video,"onUpdate:modelValue":t[16]||(t[16]=s=>e.yt_video=s),counter:100,onChange:n.save,label:l.$t("yt_video"),"hide-details":""},null,8,["modelValue","onChange","label"]),d("div",null,[o(m,{modelValue:e.documents_flag,"onUpdate:modelValue":t[17]||(t[17]=s=>e.documents_flag=s),onChange:n.documents_load,label:l.$t("documents_flag")},null,8,["modelValue","onChange","label"]),e.documents_flag?(g(),c("div",J,[_("",!0),o(N,{_id:e.id},null,8,["_id"])])):_("",!0)]),d("div",null,[o(m,{modelValue:e.album_flag,"onUpdate:modelValue":t[19]||(t[19]=s=>e.album_flag=s),onChange:n.gallery_change,label:l.$t("album_flag")},null,8,["modelValue","onChange","label"]),e.album_flag?(g(),c("div",K,[o(S,{caption:!1,id:e.gallery_id},null,8,["id"])])):_("",!0)]),t[23]||(t[23]=d("div",null,[d("div")],-1))])}const Y=q(j,[["render",O]]);export{Y as default};
