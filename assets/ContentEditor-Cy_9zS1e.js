import{D as c,b as r,S as N,u as C,d as i,Q as x,v as q,I as U,e as L,_ as A,r as _,c as g,a as d,i as a,w as u,j as f,t as b,k as h,o as p}from"./index-BgiqF3r5.js";import{m as V}from"./moment-with-locales-DeWeGRWP.js";import{A as j}from"./AlbumViewer-CU7DQ6LH.js";const z={data(){return{title_en:"",title_hu:"",title_rs:"",content_rs:"",content_hu:"",content_en:"",yt_video:"",show_date:!1,srb_flag:!0,hun_flag:!0,en_flag:!1,visible:!1,documents_flag:!1,album_flag:!1,default_img_link:"",gallery_id:"",file_link:null,fb_message:"",fb_public:!1,img:"",headers:[],colDefs:[],documents:[],doc_loaded:!1,notNews:!0,uploading:!1}},components:{AlbumViewer:j},mounted(){this.getMD(),this.headers=[{title:this.$t("name"),align:"start",sortable:!1,key:"name",width:"200px"},{title:this.$t("date"),align:"start",key:"date",width:"300px"},{title:this.$t("open_document"),align:"start",key:"open",width:"300px"}],this.headers.push({title:this.$t("edit_document"),align:"start",key:"edit",width:"300px"}),this.colDefs.push({field:"edit",headerName:this.$t("edit_message"),sortable:!0,filter:!0}),window.addEventListener("beforeunload",this.handleBeforeUnload)},onBeforeUnmount(){window.removeEventListener("beforeunload",this.handleBeforeUnload)},methods:{async getMD(){const s=new c(r),t=new N(r);C();let n=await s.listDocuments(i.website_db,i.about_us_db,[x.equal("$id",this.$route.params.id)]);this.title_rs=n.documents[0].title_rs,this.content_rs=n.documents[0].text_rs,this.title_hu=n.documents[0].title_hu,this.content_hu=n.documents[0].text_hu,this.title_en=n.documents[0].title_en,this.content_en=n.documents[0].text_en,this.yt_video=n.documents[0].yt_video,this.visible=n.documents[0].visible,this.notNews=n.documents[0].notNews,this.show_date=n.documents[0].show_date,n.documents[0].default_image==null||n.documents[0].default_image==""?this.img="https://dummyimage.com/720x400":this.img=t.getFileView(i.website_images,n.documents[0].default_image).toString(),this.gallery_id=n.documents[0].gallery,this.documents_flag=n.documents[0].has_documents,this.album_flag=n.documents[0].has_gallery,this.synchronize_documents()},handleBeforeUnload(s){if(this.uploading)return s.preventDefault(),this.$notify({type:"error",text:this.$t("file_still_uploading")}),s.returnValue="",""},async save(){const s=new c(r);await s.listDocuments(i.website_db,i.about_us_db,[x.equal("$id",this.$route.params.id)]),await s.updateDocument(i.website_db,i.about_us_db,this.$route.params.id,{title_rs:this.title_rs,title_hu:this.title_hu,title_en:this.title_en,text_en:this.content_en,text_hu:this.content_hu,text_rs:this.content_rs,isHungarian:this.hun_flag,isSerbian:this.srb_flag,isEnglish:this.en_flag,visible:this.visible,yt_video:this.yt_video,has_documents:this.documents_flag,has_gallery:this.album_flag,gallery:this.gallery_id,default_image:this.default_image,notNews:this.notNews,show_date:this.show_date}),this.$notify(this.$t("saved"))},async share_fb(){let t=await new c(r).getDocument(i.website_db,i.users_settings,"fb_access_token"),n=`https://share.tsada.edu.rs/${this.$route.params.id}`;const y=await q.post(`https://graph.facebook.com/v20.0/${i.pan}/feed`,{message:null,link:n,access_token:t.parameter,published:!0});console.log(y)},async documents_load(){this.save(),this.synchronize_documents()},async gallery_change(){this.gallery_id==null&&(this.gallery_id=await this.new_gallery()),this.save()},rt_time(s){let n=C().language;return n=="rs"||n=="sr"?V.locale("sr"):n=="hu"?V.locale("hu"):n=="en"&&V.locale("en"),V(s).format("LLL")},async new_stuff(){const t=await new c(r).createDocument(i.website_db,i.text_documents,U.unique(),{texts:this.$route.params.id});this.$router.push("/admin/text-document-editor/"+t.$id)},async new_gallery(){return(await new c(r).createDocument(i.website_db,i.gallery,U.unique(),{visible:!1})).$id},async synchronize_documents(){const s=new c(r);if(this.documents_flag){this.doc_loaded=!1,this.documents=[];let n=C().language;await(await s.listDocuments(i.website_db,i.text_documents,[x.equal("texts",[this.$route.params.id])])).documents.forEach(async e=>{let o={name:"",contact:"",img:"",id:"",doc_id:"",date:""};o.id=e.$id,n=="en"||n=="hu"?(o.name=e.document_title_hu,o.contact=e.contact):(n=="rs"||n=="sr")&&(o.name=L(e.document_title_rs),o.contact=e.contact),o.id=e.$id,o.doc_id=e.document_id,o.date=e.$createdAt,this.documents.push(o)}),this.doc_loaded=!0}},async delete_content(){await new c(r).deleteDocument(i.website_db,i.about_us_db,this.$route.params.id),this.$notify(this.$t("deleted")),this.$router.push("home")},async file_upload(){if(!this.file_link){console.warn("no file");return}console.log("file_upload"),this.uploading=!0;const t=await new N(r).createFile(i.website_images,U.unique(),this.file_link);this.default_image=t.$id,this.save(),this.getMD(),this.$notify(this.$t("file_uploaded")),this.uploading=!1}}},M={class:"relative mb-4 container px-5 mx-auto bg-white"},Q={class:"flex flex-wrap -m-4"},F={class:"xl:w-1/5 md:w-1/2 p-4 cursor-pointer"},I={class:"bg-slate-100/30 hover:bg-sky-600/30 dark:bg-slate-300/30 p-6 rounded-lg shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07),0_10px_20px_-2px_rgba(0,0,0,0.04)]"},H=["src"],T={key:0},G={key:0},J={key:0},K={key:0},O={class:"m-auto w-full"},P=d("i",{class:"pi pi-book text-5xl"},null,-1),R=d("i",{class:"pi pi-cloud-upload text-5xl"},null,-1),W={key:0},X=d("div",null,[d("div")],-1);function Y(s,t,n,y,e,o){const m=_("v-switch"),w=_("v-btn"),S=_("v-file-input"),v=_("v-text-field"),k=_("ckeditor");_("QuillEditor");const D=_("router-link"),B=_("v-data-table"),E=_("AlbumViewer");return p(),g("div",M,[d("div",null,[a(m,{onChange:o.save,modelValue:e.visible,"onUpdate:modelValue":t[0]||(t[0]=l=>e.visible=l),label:s.$t("visible")},null,8,["onChange","modelValue","label"]),a(m,{onChange:o.save,modelValue:e.notNews,"onUpdate:modelValue":t[1]||(t[1]=l=>e.notNews=l),label:s.$t("not_news")},null,8,["onChange","modelValue","label"]),a(m,{onChange:o.save,modelValue:e.show_date,"onUpdate:modelValue":t[2]||(t[2]=l=>e.show_date=l),label:s.$t("show_date")},null,8,["onChange","modelValue","label"]),a(w,{class:"m-5",onClick:o.save},{default:u(()=>[f(b(s.$t("save")),1)]),_:1},8,["onClick"]),a(w,{class:"m-5",onClick:o.delete_content},{default:u(()=>[f(b(s.$t("delete")),1)]),_:1},8,["onClick"]),a(w,{class:"m-5",onClick:o.share_fb},{default:u(()=>[f(b(s.$t("fb_share")),1)]),_:1},8,["onClick"])]),d("div",null,[a(S,{onChange:o.file_upload,modelValue:e.file_link,"onUpdate:modelValue":t[3]||(t[3]=l=>e.file_link=l),accept:"image/*",label:s.$t("fileupload")},null,8,["onChange","modelValue","label"]),f(" "+b(s.$t("preview"))+" ",1),d("div",Q,[d("div",F,[d("div",I,[d("img",{class:"h-40 rounded w-full object-cover object-center mb-6 transition duration-300 ease-in-out",src:e.img,alt:"content"},null,8,H)])])])]),d("div",null,[a(m,{onChange:o.save,modelValue:e.srb_flag,"onUpdate:modelValue":t[4]||(t[4]=l=>e.srb_flag=l),label:s.$t("srb")},null,8,["onChange","modelValue","label"]),e.srb_flag?(p(),g("div",T,[a(v,{onChange:o.save,modelValue:e.title_rs,"onUpdate:modelValue":t[5]||(t[5]=l=>e.title_rs=l),counter:100,label:s.$t("srb_title"),"hide-details":""},null,8,["onChange","modelValue","label"]),a(k,{modelValue:e.content_rs,"onUpdate:modelValue":t[6]||(t[6]=l=>e.content_rs=l)},null,8,["modelValue"]),h("",!0)])):h("",!0)]),d("div",null,[a(m,{modelValue:e.hun_flag,"onUpdate:modelValue":t[8]||(t[8]=l=>e.hun_flag=l),onChange:o.save,label:s.$t("hu")},null,8,["modelValue","onChange","label"]),e.hun_flag?(p(),g("div",G,[a(v,{modelValue:e.title_hu,"onUpdate:modelValue":t[9]||(t[9]=l=>e.title_hu=l),counter:100,onChange:o.save,label:s.$t("hu_title"),"hide-details":""},null,8,["modelValue","onChange","label"]),a(k,{modelValue:e.content_hu,"onUpdate:modelValue":t[10]||(t[10]=l=>e.content_hu=l)},null,8,["modelValue"]),h("",!0)])):h("",!0)]),d("div",null,[a(m,{modelValue:e.en_flag,"onUpdate:modelValue":t[12]||(t[12]=l=>e.en_flag=l),onChange:o.save,label:s.$t("en")},null,8,["modelValue","onChange","label"]),e.en_flag?(p(),g("div",J,[a(v,{modelValue:e.title_en,"onUpdate:modelValue":t[13]||(t[13]=l=>e.title_en=l),counter:100,onChange:o.save,label:s.$t("en_title"),"hide-details":""},null,8,["modelValue","onChange","label"]),a(k,{modelValue:e.content_en,"onUpdate:modelValue":t[14]||(t[14]=l=>e.content_en=l)},null,8,["modelValue"]),h("",!0)])):h("",!0)]),a(v,{modelValue:e.yt_video,"onUpdate:modelValue":t[16]||(t[16]=l=>e.yt_video=l),counter:100,onChange:o.save,label:s.$t("yt_video"),"hide-details":""},null,8,["modelValue","onChange","label"]),d("div",null,[a(m,{modelValue:e.documents_flag,"onUpdate:modelValue":t[17]||(t[17]=l=>e.documents_flag=l),onChange:o.documents_load,label:s.$t("documents_flag")},null,8,["modelValue","onChange","label"]),e.documents_flag?(p(),g("div",K,[d("div",O,[a(B,{height:"400",headers:e.headers,items:e.documents},{"item.date":u(({item:l})=>[f(b(o.rt_time(l.date)),1)]),"item.open":u(({item:l})=>[a(D,{to:"/document/"+l.doc_id},{default:u(()=>[P]),_:2},1032,["to"])]),"item.edit":u(({item:l})=>[a(D,{to:"/admin/text-document-editor/"+l.id},{default:u(()=>[R]),_:2},1032,["to"])]),bottom:u(()=>[]),_:1},8,["headers","items"]),a(w,{onClick:t[18]||(t[18]=l=>o.new_stuff()),class:"m-5"},{default:u(()=>[f(b(s.$t("add_new_document_in_that_category")),1)]),_:1})])])):h("",!0)]),d("div",null,[a(m,{modelValue:e.album_flag,"onUpdate:modelValue":t[19]||(t[19]=l=>e.album_flag=l),onChange:o.gallery_change,label:s.$t("album_flag")},null,8,["modelValue","onChange","label"]),e.album_flag?(p(),g("div",W,[a(E,{caption:!1,id:e.gallery_id},null,8,["id"])])):h("",!0)]),X])}const te=A(z,[["render",Y]]);export{te as default};
